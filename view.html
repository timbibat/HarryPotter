<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Character Profile</title>
    <link rel="icon" type="image/png" href="assets/img/Hogwarts-Crest.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="assets/style.css">
</head>

<body class="bg-dark text-white" style="min-height: 100vh;">

    <nav class="navbar navbar-dark bg-black bg-opacity-75 fixed-top">
        <div class="container d-flex justify-content-between align-items-center">

            <a class="navbar-brand text-warning fw-bold" href="index.html">
                <i class="bi bi-chevron-left me-2"></i>Return to Directory
            </a>

            <div class="d-flex align-items-center">
                <button id="musicToggle" class="btn btn-link nav-link text-warning fs-5" onclick="toggleMusic()"
                    aria-label="Toggle Music">
                    <i class="bi bi-volume-mute-fill" id="musicIcon"></i>
                </button>
            </div>
        </div>
    </nav>

    <audio id="bgMusic" loop>
        <source src="assets/audio/Hedwig's Theme.mp3" type="audio/mpeg">
    </audio>

    <main class="d-flex align-items-center min-vh-100 py-5">
        <div class="container mt-4">
            <div id="statusArea" class="text-center">
                <div id="loadingSpinner" class="d-flex justify-content-center align-items-center flex-column">
                    <div class="spinner-grow text-warning" role="status" style="width: 3rem; height: 3rem;"></div>
                    <span class="mt-3 text-uppercase letter-spacing-2">Accessing Ministry Records...</span>
                </div>
                <div id="statusMessage" class="alert alert-danger mt-3" style="display:none;"></div>
            </div>

            <div id="profileArea" class="row justify-content-center" style="display:none;">
                <div class="col-lg-10">
                    <div class="card bg-black bg-opacity-75 text-white border-0 shadow-lg rounded-4 overflow-hidden"
                        style="backdrop-filter: blur(10px);">
                        <div class="card-body p-0">
                            <div class="row g-0">

                                <div
                                    class="col-lg-4 p-5 d-flex flex-column align-items-center bg-black bg-opacity-25 border-end border-secondary border-opacity-25">
                                    <div class="position-relative mb-4">
                                        <img id="profileImg" src="" alt="character" class="rounded-circle shadow-lg"
                                            style="width:200px; height:200px; object-fit:cover; border: 4px solid #D4AF37;">
                                        <img id="crest" src="assets/img/Hogwarts-Crest.png"
                                            class="position-absolute bottom-0 end-0 bg-dark rounded-circle p-1 border border-warning"
                                            style="width: 60px;">
                                    </div>

                                    <h2 id="charName" class="display-6 fw-bold text-center mb-1"
                                        style="font-family: serif;"></h2>
                                    <p id="charHouse" class="text-warning text-uppercase letter-spacing-2 small mb-4">
                                    </p>

                                    <div id="badgeRow" class="d-flex flex-wrap gap-2 justify-content-center mb-4"></div>

                                    <div class="d-grid gap-2 w-100">
                                        <a id="externalBtn" class="btn btn-outline-light rounded-pill" target="_blank"
                                            rel="noopener">
                                            <i class="bi bi-google me-2"></i>Full Profile
                                        </a>
                                    </div>
                                </div>

                                <div class="col-lg-8 p-5">
                                    <h4
                                        class="text-uppercase text-white-50 fs-6 mb-4 border-bottom border-secondary pb-2 border-opacity-50">
                                        Biographical Data
                                    </h4>

                                    <div id="detailsList" class="row g-3">
                                    </div>

                                    <div class="mt-5 text-end">
                                        <img src="assets/img/logo.png" height="30" class="opacity-50 grayscale">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>

    <script src="assets/js/music.js"></script>

    <script>
        const getCharacterDetails = async (characterName) => {
            const statusArea = document.getElementById("statusArea");
            const loadingSpinner = document.getElementById("loadingSpinner");
            const statusMessage = document.getElementById("statusMessage");
            const profileArea = document.getElementById("profileArea");

            try {
                const response = await fetch('https://hp-api.onrender.com/api/characters');
                const characters = await response.json();

                const character = characters.find(c => c.name === characterName);

                if (character) {
                    document.title = `${character.name} | Profile`;

                    document.getElementById("profileImg").src = character.image || 'assets/img/Hogwarts-Crest.png';

                    document.getElementById("charName").innerText = character.name;
                    document.getElementById("charHouse").innerText = character.house || "Unknown Affiliation";

                    const changeBackgroundImage = (house) => {
                        let backgroundImage = '';
                        switch (house) {
                            case 'Gryffindor': backgroundImage = 'url("assets/img/gryffindor.jpg")'; break;
                            case 'Slytherin': backgroundImage = 'url("assets/img/slytherin.jpg")'; break;
                            case 'Hufflepuff': backgroundImage = 'url("assets/img/hufflepuff.jpg")'; break;
                            case 'Ravenclaw': backgroundImage = 'url("assets/img/ravenclaw.jpg")'; break;
                            default: backgroundImage = 'url("assets/img/defaulthouse.jpg")'; break;
                        }
                        document.body.style.backgroundImage = backgroundImage;
                        document.body.style.backgroundSize = 'cover';
                        document.body.style.backgroundPosition = 'center';
                        document.body.style.backgroundAttachment = 'fixed';
                    };

                    changeBackgroundImage(character.house);

                    const badgeRow = document.getElementById("badgeRow");
                    badgeRow.innerHTML = '';
                    if (character.hogwartsStudent) {
                        badgeRow.innerHTML += '<span class="badge rounded-pill border border-primary text-white bg-primary bg-opacity-10 px-3 py-2">Student</span>';
                    }
                    if (character.hogwartsStaff) {
                        badgeRow.innerHTML += '<span class="badge rounded-pill border border-success text-white bg-success bg-opacity-10 px-3 py-2">Staff</span>';
                    }
                    if (character.wizard) {
                        badgeRow.innerHTML += '<span class="badge rounded-pill border border-warning text-warning bg-warning bg-opacity-10 px-3 py-2">Witch/Wizard</span>';
                    }

                    const detailsList = document.getElementById("detailsList");

                    const createDataCard = (label, value, icon) => `
                        <div class="col-sm-6 mb-2">
                            <div class="p-3 rounded bg-white bg-opacity-10 border border-white border-opacity-10 h-100">
                                <div class="d-flex align-items-center mb-1">
                                    <i class="bi ${icon} text-warning me-2"></i>
                                    <small class="text-white-50 text-uppercase" style="font-size: 0.75rem;">${label}</small>
                                </div>
                                <div class="fw-semibold text-white text-break">${value}</div>
                            </div>
                        </div>
                    `;

                    detailsList.innerHTML = `
                        ${createDataCard('Species', character.species || "Unknown", 'bi-person-standing')}
                        ${createDataCard('Gender', character.gender || "Unknown", 'bi-gender-ambiguous')}
                        ${createDataCard('Date of Birth', character.dateOfBirth || "Unknown", 'bi-calendar-event')}
                        ${createDataCard('Vital Status', character.alive ? 'Alive' : 'Deceased', 'bi-heart-pulse')}
                        ${createDataCard('Ancestry', character.ancestry || "Unknown", 'bi-tree')}
                        ${createDataCard('Patronus', character.patronus || "None", 'bi-stars')}
                        ${createDataCard('Eye Color', character.eyeColour || "Unknown", 'bi-eye')}
                        ${createDataCard('Hair Color', character.hairColour || "Unknown", 'bi-palette')}
                        <div class="col-12 mt-3">
                            <div class="p-3 rounded bg-warning bg-opacity-10 border border-warning border-opacity-25">
                                <div class="d-flex align-items-center mb-1">
                                    <i class="bi bi-magic text-warning me-2"></i>
                                    <small class="text-warning text-uppercase" style="font-size: 0.75rem;">Wand Specification</small>
                                </div>
                                <div class="fw-semibold text-white">
                                    ${character.wand && character.wand.wood ?
                            `${character.wand.wood}, ${character.wand.core}, ${character.wand.length ? character.wand.length + '"' : 'unknown length'}` :
                            "No wand record found"}
                                </div>
                            </div>
                        </div>
                    `;

                    document.getElementById("externalBtn").href =
                        `https://www.google.com/search?q=${encodeURIComponent(character.name + ' Harry Potter wiki')}`;

                    loadingSpinner.style.display = 'none';
                    statusArea.style.display = 'none';
                    profileArea.style.display = 'flex';

                } else {
                    loadingSpinner.style.display = 'none';
                    statusMessage.style.display = 'block';
                    statusMessage.innerText = "Record Not Found in Archives";
                }
            } catch (error) {
                console.error("Error fetching character details:", error);
                loadingSpinner.style.display = 'none';
                statusMessage.style.display = 'block';
                statusMessage.innerText = "Ministry Connection Failed";
            }
        };

        const urlParams = new URLSearchParams(window.location.search);
        const characterName = urlParams.get('characterID');
        if (characterName) {
            getCharacterDetails(characterName);
        } else {
            document.getElementById("loadingSpinner").style.display = 'none';
            document.getElementById("statusMessage").style.display = 'block';
            document.getElementById("statusMessage").innerText = "No Character Identity Provided";
        }
    </script>
</body>

</html>